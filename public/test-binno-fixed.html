<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTDHUB - BINNO AI Test (Fixed)</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            color: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .container {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #2a2a2a;
        }
        .header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .logo {
            width: 60px;
            height: 60px;
            background: #FFCC33;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: #000;
            font-size: 20px;
        }
        h1 {
            color: #FFCC33;
            margin: 0;
        }
        .subtitle {
            color: #8BE9FD;
            margin: 0;
            font-size: 14px;
        }
        button {
            background: #FFCC33;
            color: #000;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #FFC700;
            transform: translateY(-2px);
        }
        .result {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #8BE9FD;
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        .error {
            background: #2a0a0a;
            border-left-color: #ff5555;
        }
        .success {
            border-left-color: #00D4AA;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 13px;
            line-height: 1.5;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #00D4AA; }
        .status-error { background: #FF5555; }
        .status-loading { background: #FFCC33; animation: pulse 1s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ü§ñ</div>
            <div>
                <h1>BINNO AI Test (Fixed)</h1>
                <p class="subtitle">CTDHUB - Timeout Issues Resolved</p>
            </div>
        </div>
        
        <p>Test the corrected BINNO AI analysis with timeout protection</p>
        
        <button onclick="testOriginalFunction()">üîÑ Test Original Function</button>
        <button onclick="testQuickFunction()">‚ö° Test Quick Function</button>
        <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
        
        <div id="result" class="result" style="display: none;">
            <h3>Results:</h3>
            <pre id="output"></pre>
        </div>
    </div>

    <script>
        async function testOriginalFunction() {
            await testFunction('/.netlify/functions/binno-final-analysis', 'Original Function (120s timeout)');
        }
        
        async function testQuickFunction() {
            await testFunction('/.netlify/functions/binno-final-analysis-quick', 'Quick Function (60s timeout)');
        }
        
        async function testFunction(endpoint, functionName) {
            const resultDiv = document.getElementById('result');
            const outputPre = document.getElementById('output');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            outputPre.innerHTML = `<span class="status-indicator status-loading"></span>Testing ${functionName}...`;
            
            const testData = {
                sessionId: "test-fixed-" + Date.now(),
                userAnswers: [
                    {
                        question_text: "Tell me about your Web3 project. What is the project name, token supply, blockchain network, and main focus?",
                        user_response: "CTDHUB is an innovative Web3 educational platform that uses artificial intelligence for blockchain project analysis and evaluation. The project plans to launch 1 billion CTD tokens on BNB Smart Chain, focusing on DeFi education and productivity tools. Our vision is to democratize Web3 knowledge access through personalized AI analysis, gamified reward systems, and strategic partnerships with established projects.",
                        timestamp: Date.now()
                    },
                    {
                        question_text: "How does the project ensure security and efficiency of smart contracts within the technical architecture?",
                        user_response: "We implement multiple security layers: comprehensive CertiK audit, OpenZeppelin libraries usage, multi-sig pattern for critical functions, timelock for governance changes, and formal verification for complex logic. We utilize Chainlink for external oracles, Mythril for automated testing, and ImmuneFi for bug bounty programs.",
                        timestamp: Date.now()
                    }
                ],
                language: "en"
            };
            
            const startTime = Date.now();
            
            try {
                console.log(`Testing ${functionName} at:`, endpoint);
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(1);
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.classList.add('success');
                    outputPre.innerHTML = `<span class="status-indicator status-success"></span><strong>‚úÖ ${functionName} WORKING!</strong>\\n\\n` +
                        `‚è±Ô∏è <strong>Duration:</strong> ${duration}s\\n` +
                        `üìä <strong>Score:</strong> ${data.score}%\\n\\n` +
                        `üìù <strong>Analysis:</strong> ${data.analysis}\\n\\n` +
                        `üîß <strong>Report Keys:</strong> ${Object.keys(data.report || {}).join(', ')}\\n\\n` +
                        `üåê <strong>Endpoint:</strong> ${endpoint}`;
                } else {
                    throw new Error(data.error || `HTTP ${response.status}`);
                }
            } catch (error) {
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(1);
                
                outputPre.innerHTML = `<span class="status-indicator status-error"></span><strong>‚ùå ERROR in ${functionName}:</strong>\\n\\n` +
                    `‚è±Ô∏è Duration: ${duration}s\\n` +
                    `üîó Endpoint: ${endpoint}\\n` +
                    `üí• Error: ${error.message}\\n\\n` +
                    `üìã Debug Info:\\n` +
                    `- Network: ${navigator.onLine ? 'Online' : 'Offline'}\\n` +
                    `- User Agent: ${navigator.userAgent.substring(0, 50)}...`;
                    
                resultDiv.classList.add('error');
            }
        }
        
        function clearResults() {
            document.getElementById('result').style.display = 'none';
        }
        
        // Auto-test on load
        window.addEventListener('load', () => {
            console.log('üß™ BINNO AI Test Page Loaded');
            console.log('üåê Current domain:', window.location.hostname);
            console.log('üì° Available endpoints:');
            console.log('  - /.netlify/functions/binno-final-analysis');
            console.log('  - /.netlify/functions/binno-final-analysis-quick');
        });
    </script>
</body>
</html>