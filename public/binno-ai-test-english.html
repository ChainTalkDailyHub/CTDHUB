<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTDHUB - BINNO AI Analysis Test</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            color: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .container {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #2a2a2a;
        }
        .header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .logo {
            width: 60px;
            height: 60px;
            background: #FFCC33;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: #000;
            font-size: 20px;
        }
        h1 {
            color: #FFCC33;
            margin: 0;
        }
        .subtitle {
            color: #8BE9FD;
            margin: 0;
            font-size: 14px;
        }
        button {
            background: #FFCC33;
            color: #000;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #FFC700;
            transform: translateY(-2px);
        }
        .result {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #8BE9FD;
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        .error {
            background: #2a0a0a;
            border-left-color: #ff5555;
        }
        .success {
            border-left-color: #00D4AA;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 13px;
            line-height: 1.5;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #00D4AA; }
        .status-error { background: #FF5555; }
        .status-loading { background: #FFCC33; animation: pulse 1s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ü§ñ</div>
            <div>
                <h1>BINNO AI Analysis Test</h1>
                <p class="subtitle">CTDHUB Web3 Educational Platform</p>
            </div>
        </div>
        
        <p>Test the new 100% AI-powered analysis system (no fallback)</p>
        
        <button onclick="testRealAIAnalysis()">üöÄ Test Real AI Analysis</button>
        <button onclick="testPDFGeneration()">üìÑ Generate PDF Report</button>
        <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
        
        <div id="result" class="result" style="display: none;">
            <h3>Results:</h3>
            <pre id="output"></pre>
        </div>
    </div>

    <script>
        async function testRealAIAnalysis() {
            const resultDiv = document.getElementById('result');
            const outputPre = document.getElementById('output');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            outputPre.innerHTML = '<span class="status-indicator status-loading"></span>Testing real AI analysis...';
            
            const testData = {
                sessionId: "test-binno-ai-" + Date.now(),
                userAnswers: [
                    {
                        question_text: "Tell me about your Web3 project. What is the project name, token supply, blockchain network, and main focus?",
                        user_response: "CTDHUB is an innovative Web3 educational platform that uses artificial intelligence for blockchain project analysis and evaluation. The project plans to launch 1 billion CTD tokens on BNB Smart Chain, focusing on DeFi education and productivity tools. Our vision is to democratize Web3 knowledge access through personalized AI analysis, gamified reward systems, and strategic partnerships with established projects. We solve the problem of lack of objective and standardized Web3 project evaluation by offering assessments based on reliable metrics and educational feedback.",
                        timestamp: Date.now()
                    },
                    {
                        question_text: "How does the project ensure security and efficiency of smart contracts within the technical architecture?",
                        user_response: "We implement multiple security layers: comprehensive CertiK audit, OpenZeppelin libraries usage, multi-sig pattern for critical functions, timelock for governance changes, and formal verification for complex logic. We utilize Chainlink for external oracles, Mythril for automated testing, and ImmuneFi for bug bounty programs. The architecture follows established EIP patterns with controlled upgradeability via proxy pattern.",
                        timestamp: Date.now()
                    },
                    {
                        question_text: "How does the project plan to balance user engagement incentives through airdrop points while maintaining long-term value and stability of the native token?",
                        user_response: "Dual-token model: CTD (governance) and LEARN (utility). Automatic burning system based on activity, staged vesting for early adopters, staking rewards with decreasing APY over time. 15% supply total stabilization reserve, buy-back trigger mechanism on 20%+ drops, partnerships for real utility beyond platform, and multi-chain expansion roadmap. Tokenomics audited by token economy specialists.",
                        timestamp: Date.now()
                    }
                ],
                language: "en"
            };
            
            try {
                // Auto-detect API endpoint (Next.js local vs Netlify production)
                const apiEndpoint = window.location.hostname === 'localhost' 
                    ? '/api/binno-final-analysis'
                    : '/.netlify/functions/binno-final-analysis';
                
                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.classList.add('success');
                    outputPre.innerHTML = `<span class="status-indicator status-success"></span><strong>‚úÖ REAL AI ANALYSIS WORKING!</strong>\\n\\n` +
                        `üìä <strong>Score:</strong> ${data.score}%\\n\\n` +
                        `üìù <strong>Analysis:</strong> ${data.analysis}\\n\\n` +
                        `üîß <strong>Structured Data:</strong>\\n${JSON.stringify(data.report, null, 2)}`;
                } else {
                    throw new Error(data.error || 'Analysis failed');
                }
            } catch (error) {
                outputPre.innerHTML = `<span class="status-indicator status-error"></span><strong>‚ùå ERROR:</strong> ${error.message}`;
                resultDiv.classList.add('error');
            }
        }
        
        async function testPDFGeneration() {
            const resultDiv = document.getElementById('result');
            const outputPre = document.getElementById('output');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            outputPre.innerHTML = '<span class="status-indicator status-loading"></span>Generating professional PDF report...';
            
            // Mock comprehensive analysis data for PDF testing
            const mockAnalysisData = {
                executive_summary: "Based on 3 detailed responses, your current score is 78%. Demonstrates solid technical knowledge in Web3, practical experience with smart contracts, and advanced understanding of tokenomics. This profile indicates readiness for implementation with some strategic optimizations recommended.",
                score: 78,
                strengths: [
                    "Solid technical knowledge in smart contract architecture and security patterns",
                    "Proven experience with security audits (CertiK, Mythril, ImmuneFi)",
                    "Well-structured tokenomics model with clear utility and sustainability",
                    "Implementation of best practices (OpenZeppelin, multi-sig, timelock)",
                    "Clear product vision focused on solving real problems",
                    "Knowledge of professional tools (Chainlink, formal verification)"
                ],
                weaknesses: [
                    "Mentioned partnerships (15+ projects) need more specific validation",
                    "Go-to-market strategy could be more detailed",
                    "Success metrics and KPIs were not clearly defined",
                    "Limited competitive analysis in current market context"
                ],
                improvements: [
                    "Document partnerships strategically with evidence",
                    "Develop technical roadmap with specific milestones and timeframes",
                    "Create metrics dashboard for protocol performance tracking",
                    "Establish formal community building and decentralized governance program",
                    "Implement on-chain analytics system for continuous optimization"
                ],
                study_plan: [
                    {
                        area: "Advanced DeFi Architecture",
                        priority: "Medium",
                        resources: ["Uniswap V3 whitepaper analysis", "Compound governance deep dive", "MEV protection strategies"],
                        timeframe: "3-4 weeks",
                        evidence: "Strong technical foundation, but can deepen knowledge in complex DeFi protocols"
                    },
                    {
                        area: "Tokenomics Optimization",
                        priority: "High",
                        resources: ["Token engineering courses (Outlier Ventures)", "Balancer smart pools documentation", "Sustainable projects case studies"],
                        timeframe: "2-3 weeks",
                        evidence: "Current model is good, but needs refinement for longevity"
                    }
                ],
                next_actions: [
                    "Validate and formally document the 15+ mentioned partnerships",
                    "Create functional MVP with 3-5 educational modules for beta testing",
                    "Establish clear success metrics (DAU, retention, completion rates)",
                    "Prepare strategy paper for investment or grants acquisition",
                    "Implement beta tester program with early adopters",
                    "Develop complete technical documentation for developers"
                ],
                learning_resources: [
                    "Token Engineering Academy - Advanced Tokenomics Design",
                    "a16z Crypto Startup School - Web3 Go-to-Market",
                    "Messari Research Reports - DeFi Education Market Analysis",
                    "Bankless DAO - Community Building Best Practices"
                ],
                risks: [
                    "Dependence on unvalidated partnerships may affect initial traction",
                    "Dual-token model adds complexity that needs clear communication",
                    "Intense competition in Web3 education space"
                ],
                copy_paste_detected: false,
                copy_paste_explanation: "Original and specific responses detected throughout the analysis"
            };
            
            const mockUserAnswers = [
                {
                    question_text: "Tell me about your Web3 project",
                    user_response: "CTDHUB is an innovative Web3 educational platform..."
                },
                {
                    question_text: "How do you ensure smart contract security?",
                    user_response: "We implement multiple security layers..."
                }
            ];
            
            try {
                // Generate PDF HTML directly
                const pdfHTML = generateProfessionalPDFHTML(
                    mockAnalysisData,
                    mockUserAnswers,
                    'professional-test-session'
                );
                
                // Open PDF in new window
                const pdfWindow = window.open('', '_blank', 'width=1000,height=800');
                if (pdfWindow) {
                    pdfWindow.document.write(pdfHTML);
                    pdfWindow.document.close();
                    pdfWindow.document.title = 'CTDHUB - BINNO AI Analysis Report';
                }
                
                resultDiv.classList.add('success');
                outputPre.innerHTML = '<span class="status-indicator status-success"></span><strong>‚úÖ PDF Generated Successfully!</strong>\\n\\n' +
                    'PDF opened in new window featuring:\\n' +
                    '‚Ä¢ CTDHUB updated theme with logo\\n' +
                    '‚Ä¢ BINNO AI branding\\n' +
                    '‚Ä¢ Real structured AI data\\n' +
                    '‚Ä¢ Score: 78%\\n' +
                    '‚Ä¢ Complete analysis with strengths, weaknesses, study plan\\n' +
                    '‚Ä¢ Professional English interface\\n' +
                    '‚Ä¢ Print-ready format';
                
            } catch (error) {
                outputPre.innerHTML = `<span class="status-indicator status-error"></span><strong>‚ùå PDF Generation Error:</strong> ${error.message}`;
                resultDiv.classList.add('error');
            }
        }
        
        function clearResults() {
            document.getElementById('result').style.display = 'none';
        }
        
        // Professional PDF generator function
        function generateProfessionalPDFHTML(analysisData, userAnswers, sessionId) {
            const currentDate = new Date();
            const dateStr = currentDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const timeStr = currentDate.toLocaleTimeString('en-US');
            const projectName = userAnswers[0]?.user_response?.split('.')[0]?.split(',')[0]?.trim() || 'Web3 Project';
            const score = analysisData.score || 0;
            
            const getScoreColor = (score) => {
                if (score >= 70) return '#00D4AA';
                if (score >= 50) return '#FFCC33';
                return '#FF5555';
            };
            
            const getScoreEmoji = (score) => {
                if (score >= 80) return 'üöÄ';
                if (score >= 70) return 'üí™';
                if (score >= 50) return 'üìà';
                if (score >= 30) return '‚ö†Ô∏è';
                return 'üî¥';
            };
            
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CTDHUB - BINNO AI Analysis Report</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #000000; color: #F2F2F2; line-height: 1.6; }
        .pdf-container { width: 210mm; min-height: 297mm; background: #000000; margin: 0 auto; box-shadow: 0 0 40px rgba(255, 204, 51, 0.2); }
        .pdf-header { background: linear-gradient(135deg, #FFCC33 0%, #FFC700 50%, #FFCC33 100%); height: 140px; padding: 30px 40px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 8px 32px rgba(255, 204, 51, 0.4); position: relative; overflow: hidden; }
        .pdf-header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><pattern id="circuit" patternUnits="userSpaceOnUse" width="40" height="40"><path d="M10 10h20v20h-20z" fill="none" stroke="%23000" stroke-width="0.5" opacity="0.1"/><circle cx="20" cy="20" r="2" fill="%23000" opacity="0.1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23circuit)"/></svg>'); opacity: 0.3; }
        .header-left { display: flex; align-items: center; gap: 25px; z-index: 2; position: relative; }
        .logo-section { display: flex; align-items: center; gap: 15px; }
        .main-logo { height: 80px; width: auto; object-fit: contain; background: transparent; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3)); }
        .logo-fallback { height: 80px; width: 200px; background: rgba(0,0,0,0.15); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 24px; color: #000; letter-spacing: 2px; border: 3px solid #000; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .header-info { color: #000; }
        .header-info h1 { font-size: 32px; font-weight: 900; margin-bottom: 8px; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .header-info .subtitle { font-size: 18px; font-weight: 600; opacity: 0.8; margin-bottom: 8px; }
        .binno-badge { background: rgba(0,0,0,0.2); color: #000; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 700; display: inline-block; margin-bottom: 4px; border: 1px solid #000; }
        .header-right { text-align: right; color: #000; z-index: 2; position: relative; }
        .score-display { background: rgba(0,0,0,0.15); padding: 20px; border-radius: 16px; border: 3px solid #000; text-align: center; min-width: 120px; }
        .score-number { font-size: 36px; font-weight: 900; color: ${getScoreColor(score)}; text-shadow: 0 2px 8px rgba(0,0,0,0.3); margin-bottom: 5px; }
        .score-label { font-size: 14px; font-weight: 600; opacity: 0.8; }
        .pdf-content { padding: 40px; background: linear-gradient(180deg, #000000 0%, #0A0A0A 100%); min-height: calc(297mm - 280px); }
        .analysis-title { font-size: 28px; font-weight: 800; color: #FFCC33; text-align: center; margin-bottom: 40px; text-shadow: 0 0 20px rgba(255, 204, 51, 0.6); border-bottom: 2px solid #2A2A2A; padding-bottom: 20px; }
        .project-info { background: linear-gradient(135deg, #1a1a1a 0%, #0E0E0E 100%); padding: 25px; border-radius: 16px; border: 2px solid #2A2A2A; border-left: 4px solid #8BE9FD; margin-bottom: 30px; }
        .project-info h3 { color: #8BE9FD; font-size: 18px; margin-bottom: 15px; font-weight: 700; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .info-item { background: rgba(255, 204, 51, 0.1); padding: 15px; border-radius: 12px; border: 1px solid #2A2A2A; }
        .info-item strong { color: #FFCC33; display: block; margin-bottom: 5px; font-weight: 600; }
        .executive-summary { background: linear-gradient(135deg, #1a1a1a 0%, #0E0E0E 100%); padding: 30px; border-radius: 16px; border: 2px solid #2A2A2A; border-left: 4px solid #FFCC33; margin-bottom: 30px; position: relative; }
        .executive-summary::before { content: '${getScoreEmoji(score)}'; position: absolute; top: -15px; right: 20px; font-size: 30px; background: #000; padding: 5px 15px; border-radius: 20px; border: 2px solid #FFCC33; }
        .executive-summary h3 { color: #FFCC33; font-size: 20px; margin-bottom: 15px; font-weight: 700; }
        .analysis-section { background: linear-gradient(135deg, #1a1a1a 0%, #0E0E0E 100%); padding: 25px; border-radius: 16px; border: 2px solid #2A2A2A; margin-bottom: 25px; }
        .strengths-section { border-left: 4px solid #00D4AA; }
        .weaknesses-section { border-left: 4px solid #FF5555; }
        .improvements-section { border-left: 4px solid #8BE9FD; }
        .analysis-section h3 { font-size: 18px; margin-bottom: 20px; font-weight: 700; }
        .strengths-section h3 { color: #00D4AA; }
        .weaknesses-section h3 { color: #FF5555; }
        .improvements-section h3 { color: #8BE9FD; }
        .analysis-list { list-style: none; padding: 0; }
        .analysis-list li { padding: 12px 0; border-bottom: 1px solid #2A2A2A; padding-left: 25px; position: relative; }
        .analysis-list li::before { content: '‚ñ∂'; position: absolute; left: 0; color: #FFCC33; font-size: 12px; }
        .study-plan { background: linear-gradient(135deg, #1a1a1a 0%, #0E0E0E 100%); padding: 30px; border-radius: 16px; border: 2px solid #2A2A2A; border-left: 4px solid #BD93F9; margin-bottom: 30px; }
        .study-plan h3 { color: #BD93F9; font-size: 20px; margin-bottom: 25px; font-weight: 700; }
        .study-item { background: rgba(189, 147, 249, 0.1); padding: 20px; border-radius: 12px; border: 1px solid #2A2A2A; margin-bottom: 20px; }
        .study-item h4 { color: #BD93F9; font-size: 16px; margin-bottom: 15px; font-weight: 600; }
        .study-details { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .study-detail { font-size: 14px; }
        .study-detail strong { color: #8BE9FD; font-weight: 600; }
        .resources-list { margin-top: 10px; list-style: none; }
        .resources-list li { font-size: 13px; color: #F2F2F2; margin-bottom: 5px; padding-left: 15px; position: relative; }
        .resources-list li::before { content: 'üìö'; position: absolute; left: 0; }
        .next-actions { background: linear-gradient(135deg, #1a1a1a 0%, #0E0E0E 100%); padding: 25px; border-radius: 16px; border: 2px solid #2A2A2A; border-left: 4px solid #50FA7B; margin-bottom: 30px; }
        .next-actions h3 { color: #50FA7B; font-size: 18px; margin-bottom: 20px; font-weight: 700; }
        .actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .action-item { background: rgba(80, 250, 123, 0.1); padding: 15px; border-radius: 12px; border: 1px solid #2A2A2A; font-size: 14px; }
        .pdf-footer { background: #0A0A0A; padding: 25px 40px; border-top: 2px solid #2A2A2A; display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #666; }
        @media print { body { background: white !important; } .pdf-container { box-shadow: none; } .analysis-section { break-inside: avoid; } }
    </style>
</head>
<body>
    <div class="pdf-container">
        <div class="pdf-header">
            <div class="header-left">
                <div class="logo-section">
                    <img src="/images/CTDHUB.png" alt="CTDHUB Logo" class="main-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="logo-fallback" style="display:none;">CTDHUB</div>
                </div>
                <div class="header-info">
                    <h1>CTDHUB</h1>
                    <div class="subtitle">BINNO AI Analysis</div>
                    <div class="binno-badge">Powered by Binno</div>
                    <div style="font-size: 12px; opacity: 0.7;">${dateStr} ‚Ä¢ ${timeStr}</div>
                </div>
            </div>
            <div class="header-right">
                <div class="score-display">
                    <div class="score-number">${score}%</div>
                    <div class="score-label">SCORE</div>
                </div>
            </div>
        </div>
        <div class="pdf-content">
            <h2 class="analysis-title">üìä Comprehensive Project Analysis</h2>
            
            <div class="project-info">
                <h3>üöÄ Project Information</h3>
                <div class="info-grid">
                    <div class="info-item"><strong>Project:</strong> ${projectName}</div>
                    <div class="info-item"><strong>Questions:</strong> ${userAnswers.length} answered</div>
                    <div class="info-item"><strong>Session:</strong> ${sessionId}</div>
                </div>
            </div>
            
            <div class="executive-summary">
                <h3>üìã Executive Summary</h3>
                <p>${analysisData.executive_summary}</p>
            </div>
            
            <div class="analysis-section strengths-section">
                <h3>üí™ Strengths</h3>
                <ul class="analysis-list">
                    ${analysisData.strengths.map(strength => `<li>${strength}</li>`).join('')}
                </ul>
            </div>
            
            <div class="analysis-section weaknesses-section">
                <h3>‚ö†Ô∏è Areas for Improvement</h3>
                <ul class="analysis-list">
                    ${analysisData.weaknesses.map(weakness => `<li>${weakness}</li>`).join('')}
                </ul>
            </div>
            
            <div class="analysis-section improvements-section">
                <h3>üìà Recommended Improvements</h3>
                <ul class="analysis-list">
                    ${analysisData.improvements.map(improvement => `<li>${improvement}</li>`).join('')}
                </ul>
            </div>
            
            <div class="study-plan">
                <h3>üìö Personalized Learning Plan</h3>
                ${analysisData.study_plan.map(item => `
                    <div class="study-item">
                        <h4>${item.area}</h4>
                        <div class="study-details">
                            <div class="study-detail"><strong>Priority:</strong> ${item.priority}</div>
                            <div class="study-detail"><strong>Timeframe:</strong> ${item.timeframe}</div>
                        </div>
                        <div class="study-detail"><strong>Evidence:</strong> ${item.evidence}</div>
                        <ul class="resources-list">
                            ${item.resources.map(resource => `<li>${resource}</li>`).join('')}
                        </ul>
                    </div>
                `).join('')}
            </div>
            
            <div class="next-actions">
                <h3>üéØ Next Actions (30 days)</h3>
                <div class="actions-grid">
                    ${analysisData.next_actions.map(action => `<div class="action-item">${action}</div>`).join('')}
                </div>
            </div>
        </div>
        <div class="pdf-footer">
            <div class="footer-left">
                <div><strong>CTDHUB</strong> - Web3 Educational Platform</div>
                <div>Powered by BINNO AI</div>
            </div>
            <div class="footer-right">
                <div>Generated: ${dateStr}</div>
                <div>AI Analysis ‚Ä¢ Score: ${score}%</div>
            </div>
        </div>
    </div>
</body>
</html>`;
        }
    </script>
</body>
</html>